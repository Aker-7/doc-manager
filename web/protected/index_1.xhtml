<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <f:view contentType="text/html">
        <h:head>
            <f:facet name="first">
                <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
                <title>PrimeFaces</title>
            </f:facet>

            <style>

                .ui-widget, .ui-widget .ui-widget {
                    font-size: 90% !important;
                }

                .panelColumns td{
                    vertical-align: top;
                }
            </style>

        </h:head>

        <h:body>

            <h:form id="fAdd">
                <!--*********** BEGIN ADD Dialog Box ***********-->
                <p:dialog header="New Folder" widgetVar="addFolderDialog" modal="true" resizable="false"  
                          showEffect="clip" hideEffect="fold">  
                    <p:ajax event="close" update="addFolderPanel" listener="#{folderManagedBean.initDialog()}"/> 
                    <p:outputPanel id="addFolderPanel">  
                        <p:message id="msgAddFolder" for="txAddFolder"/>  
                        <h:panelGrid columns="2" cellpadding="4">  
                            <h:outputText value="Folder Name: *" />  
                            <p:inputText id="txAddFolder" value="#{folderManagedBean.newFolderName}" required="true" requiredMessage="The field folder name is required."/> 
                            <p:commandButton icon="ui-icon-check" value="OK" update=":form:folderTree, addFolderPanel" oncomplete="handleDialogClose(xhr, status, args)" actionListener="#{folderManagedBean.addFolder}"/>
                        </h:panelGrid>  
                    </p:outputPanel>
                </p:dialog>
                <!--*********** END ADD Dialog Box ***********-->
            </h:form>

            <h:form id="fEdit">
                <!--*********** BEGIN EDIT Dialog Box ***********-->
                <p:dialog id="editFolderDialog" header="Rename Folder" widgetVar="editFolderDialog" modal="true" resizable="false"  
                          showEffect="clip" hideEffect="fold">  
                    <p:outputPanel id="editFolderPanel">  
                        <p:message id="msgEditFolder" for="txEditFolder"/>  
                        <h:panelGrid columns="2" cellpadding="4">
                            <h:outputText value="Folder Name: *" />  
                            <p:inputText id="txEditFolder" value="#{folderManagedBean.selectedNode.data.name}" required="true" requiredMessage="The field folder name is required."/> 
                            <p:commandButton icon="ui-icon-check" value="OK" update=":form:folderTree, editFolderPanel" oncomplete="handleDialogClose(xhr, status, args)" actionListener="#{folderManagedBean.renameFolder}"/>
                        </h:panelGrid>  
                    </p:outputPanel>
                </p:dialog>  
                <!--*********** END EDIT Dialog Box ***********-->       
            </h:form>

            <h:form>
                <!--*********** BEGIN DELETE Dialog Box ***********-->
                <p:confirmDialog message="Do you really want to delete this folder and all its content?"  
                                 header="Delete Folder" severity="alert" widgetVar="deleteDialog">
                    <p:commandButton id="confirm" value="Yes" update=":form:folderTree" oncomplete="deleteDialog.hide()"  
                                     actionListener="#{folderManagedBean.deleteFolder}" />  
                    <p:commandButton id="decline" value="No" onclick="deleteDialog.hide()" type="button" />  
                </p:confirmDialog>  
                <!--*********** END DELETE Dialog Box ***********-->
            </h:form>

            <h:form id="form">


                <!--*********** BEGIN Context Menu ***********-->
                <p:contextMenu for="folderTree">  
                    <p:menuitem value="New Folder" oncomplete="addFolderDialog.show()" icon="ui-icon-plus"/>
                    <p:menuitem value="Rename Folder" oncomplete="editFolderDialog.show();" icon="ui-icon-pencil"/>                    
                    <p:menuitem value="Delete Folder" oncomplete="deleteDialog.show()" icon="ui-icon-trash"/>  
                </p:contextMenu> 
                <!--*********** END Context Menu ***********-->



                <p:panelGrid styleClass="panelColumns" style="height:400px;" columns="2">   
                    <p:column>
                        <!--*********** BEGIN Folders Tree ***********-->
                        <p:tree style="border:none;" id="folderTree" value="#{folderManagedBean.root}" var="folder" selectionMode="single" selection="#{folderManagedBean.selectedNode}">  
                            <p:ajax event="select" update=":fEdit:editFolderPanel, :form:taDocuments" listener="#{folderManagedBean.onFolderSelect}"/>  
                            <p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">  
                                <h:outputText value="#{folder.name}" />  
                            </p:treeNode>  
                        </p:tree>  
                        <!--*********** END Folders Tree ***********-->
                    </p:column>
                    <p:column>
                        <!--*********** BEGIN Documents Table ***********-->
                        <p:dataTable id="taDocuments" value="#{folderManagedBean.documents}" var="document">

                            <p:column style="width:400px;" headerText="Name">  
                                <h:outputText value="#{document.name}" />  
                            </p:column>  

                            <p:column style="width:100px;" headerText="Date">  
                                <h:outputText value="#{document.documentDate}">
                                    <f:convertDateTime pattern="dd.MM.yyyy"/>
                                </h:outputText>
                            </p:column>  

                        </p:dataTable>
                        <!--*********** END Documents Table ***********-->
                    </p:column>
                </p:panelGrid>

            </h:form>


            <script type="text/javascript">  
                function handleDialogClose(xhr, status, args) {  
                    if(!args.validationFailed) {                         
                        addFolderDialog.hide();
                        editFolderDialog.hide();
                    }  
                }  
            </script>     



        </h:body>

    </f:view>
</html>

